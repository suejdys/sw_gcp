<script>
  const memoList = document.querySelector('.memo-list');

  async function fetchMemos() {
    try {
      const response = await fetch('/memos');
      if (!response.ok) throw new Error('Failed to load memos');
      const memos = await response.json();
      setMemo(memos);
    } catch (error) {
      console.error(error);
      alert('메모를 불러오는 중 오류가 발생했습니다.');
    }
  }

  function setMemo(memos) {
    memoList.innerHTML = '';
    const colors = ['#FE9B72', '#FDC771', '#E1EC8C', '#80DEEA', '#CF93D9'];
    memos.slice().reverse().forEach((memo, index) => {
      const article = document.createElement('article');
      article.setAttribute('data-id', memo.id);
      article.style.display = 'block';

      const colorIndex = (memos.length - 1 - index) % 5;
      article.style.backgroundColor = colors[colorIndex];

      const date = document.createElement('span');
      date.textContent = memo.date;
      date.style.fontSize = '16px';
      date.style.marginBottom = '6px';

      const title = document.createElement('h2');
      title.textContent = memo.title;
      title.style.fontSize = '16px';
      title.style.marginBottom = '6px';

      const content = document.createElement('p');
      content.textContent = memo.content;
      content.style.fontSize = '13px';
      content.style.marginBottom = '20px';

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = '삭제';
      deleteBtn.addEventListener('click', async () => await deleteMemo(memo.id));
      deleteBtn.style.float = 'right';
      deleteBtn.style.color = 'black';
      deleteBtn.style.backgroundColor = 'white';
      deleteBtn.style.width = '40px';
      deleteBtn.style.height = '22px';
      deleteBtn.style.position = 'relative';
      deleteBtn.style.bottom = '4px';
      deleteBtn.style.border = '2px solid black';
      deleteBtn.style.borderRadius = '7px';

      article.append(date, title, content, deleteBtn);
      memoList.append(article);
    });
  }

  async function deleteMemo(id) {
    try {
      const response = await fetch(`/memos/${id}`, {
        method: 'DELETE',
      });

      if (!response.ok) throw new Error('Failed to delete memo');
      alert('메모를 삭제했습니다.');
      fetchMemos(); // Refresh the memo list
    } catch (error) {
      console.error(error);
      alert('메모 삭제 중 오류가 발생했습니다.');
    }
  }

  window.onload = function () {
    fetchMemos();
  };
</script>
